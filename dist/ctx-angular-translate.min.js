!function(){"use strict";var a=angular.module("pascalprecht.translate",["ng"]);a.constant("$STORAGE_KEY","NG_TRANSLATE_LANG_KEY"),a.factory("$translateDefaultInterpolation",["$interpolate",function(a){var b,c={},d="default",e=null,f={escaped:function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=angular.element("<div></div>").text(a[c]).html());return b}},g=function(a){var b;return b=angular.isFunction(f[e])?f[e](a):a};return c.setLocale=function(a){b=a},c.getInterpolationIdentifier=function(){return d},c.useSanitizeValueStrategy=function(a){return e=a,this},c.interpolate=function(b,c){return e&&(c=g(c)),a(b)(c)},c}]),a.provider("$translate",["$STORAGE_KEY",function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n={},o=[],p=a,q=[],r=!1,s="translate-cloak",t=!1,u=/@\:\((.*?)?\)/g,v=".",w=function(){var a=window.navigator;return(a.language||a.browserLanguage||a.systemLanguage||a.userLanguage||"").split("-").join("_")},x=function(a){for(var b=[],d=angular.lowercase(a),e=0,f=o.length;f>e;e++)b.push(angular.lowercase(o[e]));if(b.indexOf(d)>-1)return d;if(c&&c[a]){var g=c[a];if(b.indexOf(angular.lowercase(g))>-1)return g}var h=a.split("_");return h.length>1&&b.indexOf(angular.lowercase(h[0]))>1?h[0]:void 0},y=function(a,b){if(!a&&!b)return n;if(a&&!b){if(angular.isString(a))return n[a]}else angular.isObject(n[a])||(n[a]={}),angular.extend(n[a],z(b));return this};this.translations=y,this.cloakClassName=function(a){return a?(s=a,this):s};var z=function(a,b,c,d){var e,f,g,h;b||(b=[]),c||(c={});for(e in a)a.hasOwnProperty(e)&&(h=a[e],angular.isObject(h)?z(h,b.concat(e),c,e):(f=b.length?""+b.join(v)+v+e:e,b.length&&e===d&&(g=""+b.join(v),c[g]="@:"+f),c[f]=h));return c};this.addInterpolation=function(a){return q.push(a),this},this.useMessageFormatInterpolation=function(){return this.useInterpolation("$translateMessageFormatInterpolation")},this.useInterpolation=function(a){return i=a,this},this.useSanitizeValueStrategy=function(a){return r=a,this},this.preferredLanguage=function(a){return a?(b=a,this):b},this.translationNotFoundIndicator=function(a){return this.translationNotFoundIndicatorLeft(a),this.translationNotFoundIndicatorRight(a),this},this.translationNotFoundIndicatorLeft=function(a){return a?(l=a,this):l},this.translationNotFoundIndicatorRight=function(a){return a?(m=a,this):m},this.use=function(a){if(a){if(!n[a]&&!j)throw new Error("$translateProvider couldn't find translationTable for langKey: '"+a+"'");return d=a,this}return d};var A=function(a){return a?void(p=a):g?g+p:p};this.storageKey=A,this.useUrlLoader=function(a){return this.useLoader("$translateUrlLoader",{url:a})},this.useStaticFilesLoader=function(a){return this.useLoader("$translateStaticFilesLoader",a)},this.useLoader=function(a,b){return j=a,k=b||{},this},this.useLocalStorage=function(){return this.useStorage("$translateLocalStorage")},this.useCookieStorage=function(){return this.useStorage("$translateCookieStorage")},this.useStorage=function(a){return f=a,this},this.storagePrefix=function(a){return a?(g=a,this):a},this.useMissingTranslationHandlerLog=function(){return this.useMissingTranslationHandler("$translateMissingTranslationHandlerLog")},this.useMissingTranslationHandler=function(a){return h=a,this},this.usePostCompiling=function(a){return t=!!a,this},this.determinePreferredLanguage=function(a){var c=a&&angular.isFunction(a)?a():w();return o.length?void(b=x(c)):(b=c,this)},this.registerAvailableLanguageKeys=function(a,b){return a?(o=a,b&&(c=b),this):o},this.linkKeyRegExp=function(a){return a?(u=a,this):u},this.$get=["$log","$injector","$rootScope","$q",function(a,c,g,h){var l,m=c.get(i||"$translateDefaultInterpolation"),o=!1,v={},w={},x=function(a,c,e){var g=h.defer();a=a.trim();var i=function(){var a=b?w[b]:w[d];if(f&&!a){var c=l.get(p);a=w[c]}return a}();return i?i.then(function(){E(a,c,e).then(g.resolve,g.reject)}):E(a,c,e).then(g.resolve,g.reject),g.promise},B=function(a){d=a,g.$emit("$translateChangeSuccess"),f&&l.set(x.storageKey(),d),m.setLocale(d),angular.forEach(v,function(a,b){v[b].setLocale(d)}),g.$emit("$translateChangeEnd")},C=function(a){if(!a)throw"No language key specified for loading.";var b=h.defer();return g.$emit("$translateLoadingStart"),o=!0,c.get(j)(angular.extend(k,{key:a})).then(function(c){var d={};g.$emit("$translateLoadingSuccess"),angular.isArray(c)?angular.forEach(c,function(a){angular.extend(d,z(a))}):angular.extend(d,z(c)),o=!1,b.resolve({key:a,table:d}),g.$emit("$translateLoadingEnd")},function(a){g.$emit("$translateLoadingError"),b.reject(a),g.$emit("$translateLoadingEnd")}),b.promise};if(f&&(l=c.get(f),!l.get||!l.set))throw new Error("Couldn't use storage '"+f+"', missing get() or set() method!");angular.isFunction(m.useSanitizeValueStrategy)&&m.useSanitizeValueStrategy(r),q.length&&angular.forEach(q,function(a){var e=c.get(a);e.setLocale(b||d),angular.isFunction(e.useSanitizeValueStrategy)&&e.useSanitizeValueStrategy(r),v[e.getInterpolationIdentifier()]=e});var D=function(a,b){var c=b.hasOwnProperty(a)?b[a]:void 0;if(void 0!==c)return c.match(u)&&c.match(u).length>0?c.replace(u,function(a,c){return D(c,b)}):c;throw new Error("translation error : "+a+" key not found error")},E=function(a,b,c){var e=h.defer(),f=d?n[d]:n,g=c?v[c]:m;try{e.resolve(g.interpolate(D(a,f),b))}catch(i){e.reject(i)}return e.promise};return x.preferredLanguage=function(){return b},x.cloakClassName=function(){return s},x.proposedLanguage=function(){return e},x.storage=function(){return l},x.use=function(a){if(!a)return d;var b=h.defer();return g.$emit("$translateChangeStart"),!n[a]&&j?(e=a,w[a]=C(a).then(function(a){e=void 0,y(a.key,a.table),b.resolve(a.key),B(a.key)},function(a){e=void 0,g.$emit("$translateChangeError"),b.reject(a),g.$emit("$translateChangeEnd")})):(b.resolve(a),B(a)),b.promise},x.storageKey=function(){return A()},x.isPostCompilingEnabled=function(){return t},x.refresh=function(a){function b(){e.resolve(),g.$emit("$translateRefreshEnd")}function c(){e.reject(),g.$emit("$translateRefreshEnd")}if(!j)throw new Error("Couldn't refresh translation table, no loader registered!");var e=h.defer();if(g.$emit("$translateRefreshStart"),a)n[a]?C(a).then(function(c){y(c.key,c.table),a===d&&B(d),b()},c):c();else{var f=[];d&&f.push(C(d)),h.all(f).then(function(a){angular.forEach(a,function(a){n[a.key]&&delete n[a.key],y(a.key,a.table)}),b()})}return e.promise},j&&angular.equals(n,{})&&x.use(x.use()),x}]}]),a.factory("$translateStaticFilesLoader",["$q","$http",function(a,b){return function(c){if(!c||!angular.isString(c.prefix)||!angular.isString(c.suffix))throw new Error("Couldn't load static files, no prefix or suffix specified!");var d=a.defer();return b({url:[c.prefix,c.key,c.suffix].join(""),method:"GET",params:""}).success(function(a){d.resolve(a)}).error(function(){d.reject(c.key)}),d.promise}}]),a.directive("translate",["$translate","$q","$interpolate","$compile","$parse","$rootScope",function(a,b,c,d,e,f){return{restrict:"AE",scope:!0,compile:function(b,g){var h=g.translateValues?g.translateValues:void 0,i=g.translateInterpolation?g.translateInterpolation:void 0,j=b[0].outerHTML.match(/translate-value-+/i),k=b.html();return function(b,l,m){if(b.fallbackValue=k,b.interpolateParams={},m.$observe("translate",function(a){b.translationId=angular.equals(a,"")||!angular.isDefined(a)?c(l.text().replace(/^\s+|\s+$/g,""))(b.$parent):a}),h&&m.$observe("translateValues",function(a){a&&b.$parent.$watch(function(){angular.extend(b.interpolateParams,e(a)(b.$parent))})}),j){var n=function(a){m.$observe(a,function(c){b.interpolateParams[angular.lowercase(a.substr(14))]=c})};for(var o in m)m.hasOwnProperty(o)&&"translateValue"===o.substr(0,14)&&"translateValues"!==o&&n(o)}var p=function(b,c){var e=a.isPostCompilingEnabled(),f="undefined"!=typeof g.translateCompile,h=f&&"false"!==g.translateCompile;l.html(b),(e&&!f||h)&&d(l.contents())(c)},q=function(){return h||j?function(){b.$watch("interpolateParams",function(c){b.translationId&&c&&a(b.translationId,c,i).then(function(a){p(a,b)},function(a){p(b.fallbackValue,b),b.$emit("Translation Error",a)})},!0)}:function(){var c=b.$watch("translationId",function(d){b.translationId&&d&&a(d,{},i).then(function(a){p(a,b),c()},function(a){p(b.fallbackValue,b),b.$emit("Translation Error",a),c()})},!0)}}(),r=f.$on("$translateChangeSuccess",q);q(),b.$on("$destroy",r)}}}}]),a.directive("translateCloak",["$rootScope","$translate",function(a,b){return{compile:function(c){a.$on("$translateLoadingSuccess",function(){c.removeClass(b.cloakClassName())}),c.addClass(b.cloakClassName())}}}]),a.run(["$translate",function(a){var b=a.storageKey(),c=a.storage();c?c.get(b)?a.use(c.get(b)):angular.isString(a.preferredLanguage())?a.use(a.preferredLanguage()):c.set(b,a.use()):angular.isString(a.preferredLanguage())&&a.use(a.preferredLanguage())}]),a.run(["$templateCache",function(a){a.put("templates/localeSelector.tpl.html",'<div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Language <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li data-ng-repeat="locale in localeCollection"><span class="locale-{{ locale.key }}" data-translate="common.localeSelector" ng-click="changeLocale({{locale.key}})"></span></li></ul></div>')}])}();